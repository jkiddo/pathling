"use strict";(self.webpackChunkpathling_site=self.webpackChunkpathling_site||[]).push([[797],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>g});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=p(n),c=r,g=d["".concat(s,".").concat(c)]||d[c]||m[c]||i;return n?a.createElement(g,l(l({ref:t},u),{},{components:n})):a.createElement(g,l({ref:t},u))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[d]="string"==typeof e?e:r,l[1]=o;for(var p=2;p<i;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},9882:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const i={sidebar_position:10,sidebar_label:"Kubernetes",description:"Instructions for deploying Pathling server on Kubernetes using Helm."},l="Kubernetes",o={unversionedId:"server/kubernetes",id:"server/kubernetes",title:"Kubernetes",description:"Instructions for deploying Pathling server on Kubernetes using Helm.",source:"@site/docs/server/kubernetes.md",sourceDirName:"server",slug:"/server/kubernetes",permalink:"/docs/server/kubernetes",draft:!1,editUrl:"https://github.com/aehrc/pathling/tree/main/site/docs/server/kubernetes.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10,sidebar_label:"Kubernetes",description:"Instructions for deploying Pathling server on Kubernetes using Helm."},sidebar:"server",previous:{title:"Synchronization",permalink:"/docs/server/sync"}},s={},p=[{value:"Installation",id:"installation",level:2},{value:"Values",id:"values",level:2},{value:"Example configuration",id:"example-configuration",level:2},{value:"Single node",id:"single-node",level:3},{value:"Cluster",id:"cluster",level:3}],u={toc:p},d="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"kubernetes"},"Kubernetes"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/"},"Kubernetes")," is an open-source system for automating\ndeployment, scaling, and management of containerized applications. Support for\ndeploying Pathling on Kubernetes is provided via a ",(0,r.kt)("a",{parentName:"p",href:"https://helm.sh/"},"Helm"),"\nchart."),(0,r.kt)("p",null,"The Helm chart includes the following features:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Support\nfor ",(0,r.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/"},"startup, liveness and readiness probes"),"\npowered by\nthe ",(0,r.kt)("a",{parentName:"li",href:"https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html"},"Spring Boot Actuator"),"\nendpoint"),(0,r.kt)("li",{parentName:"ul"},"Services for the FHIR API, Actuator management API, Spark UI, driver endpoint\nand block manager endpoint"),(0,r.kt)("li",{parentName:"ul"},"Support for\nthe ",(0,r.kt)("a",{parentName:"li",href:"https://spark.apache.org/docs/latest/running-on-kubernetes.html"},"Spark Kubernetes cluster manager"),",\nincluding a service account, role and role binding to allow it to manage\nexecutor pods"),(0,r.kt)("li",{parentName:"ul"},"Customisation of ",(0,r.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/"},"resource requests and limits")),(0,r.kt)("li",{parentName:"ul"},"Configuration of ",(0,r.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/concepts/storage/volumes/"},"volumes and volume mounts")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/"},"Image pull secrets"),"\nfor private Docker registries"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/"},"Tolerations and affinity"),"\nfor control over pod scheduling"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/concepts/configuration/secret/"},"Secret")," config\nfor sensitive values")),(0,r.kt)("h2",{id:"installation"},"Installation"),(0,r.kt)("p",null,"To install the chart, run the following commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Add the Pathling Helm repository.\nhelm repo add pathling https://pathling.csiro.au/helm\n\n# Get the latest information about charts from the repository.\nhelm repo update\n\n# Install the Pathling server chart as a release named `pathling`, with the \n# default values.\nhelm install pathling pathling/pathling\n")),(0,r.kt)("h2",{id:"values"},"Values"),(0,r.kt)("p",null,"This is the list of the configuration values that the chart supports, along with\ntheir default values."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Key"),(0,r.kt)("th",{parentName:"tr",align:null},"Default"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling.image")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"aehrc/pathling:latest")),(0,r.kt)("td",{parentName:"tr",align:null},"The Pathling Docker image to use")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling.resources.requests.cpu")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"2")),(0,r.kt)("td",{parentName:"tr",align:null},"The CPU request for the Pathling pod")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling.resources.requests.memory")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"4G")),(0,r.kt)("td",{parentName:"tr",align:null},"The memory request for the Pathling pod")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling.resources.limits.memory")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"4G")),(0,r.kt)("td",{parentName:"tr",align:null},"The memory limit for the Pathling pod")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling.resources.maxHeapSize")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"2800m")),(0,r.kt)("td",{parentName:"tr",align:null},"The maximum heap size for the JVM, should usually be about 75% of the available memory")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling.additionalJavaOptions")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"-Duser.timezone=UTC")),(0,r.kt)("td",{parentName:"tr",align:null},"Additional Java options to pass to the JVM")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling.deployment.strategy")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Recreate")),(0,r.kt)("td",{parentName:"tr",align:null},"The ",(0,r.kt)("a",{parentName:"td",href:"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy"},"deployment strategy")," to use")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling.deployment.imagePullPolicy")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Always")),(0,r.kt)("td",{parentName:"tr",align:null},"The ",(0,r.kt)("a",{parentName:"td",href:"https://kubernetes.io/docs/concepts/containers/images/#updating-images"},"image pull policy")," to use")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling.volumes")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"[ ]")),(0,r.kt)("td",{parentName:"tr",align:null},"A list of ",(0,r.kt)("a",{parentName:"td",href:"https://kubernetes.io/docs/concepts/storage/volumes/"},"volumes")," to mount in the pod")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling.volumeMounts")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"[ ]")),(0,r.kt)("td",{parentName:"tr",align:null},"A list of ",(0,r.kt)("a",{parentName:"td",href:"https://kubernetes.io/docs/concepts/storage/volumes/#using-volumes"},"volume mounts")," to mount")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling.serviceAccount")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"~")),(0,r.kt)("td",{parentName:"tr",align:null},"The ",(0,r.kt)("a",{parentName:"td",href:"https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/"},"service account")," to assign to the pod")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling.imagePullSecrets")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"[ ]")),(0,r.kt)("td",{parentName:"tr",align:null},"A list of ",(0,r.kt)("a",{parentName:"td",href:"https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/"},"image pull secrets")," to use")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling.tolerations")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"[ ]")),(0,r.kt)("td",{parentName:"tr",align:null},"A list of ",(0,r.kt)("a",{parentName:"td",href:"https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/"},"tolerations")," to apply to the pod")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling.affinity")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"~")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#affinity-and-anti-affinity"},"Affinity")," to apply to the pod")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling.config")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"{ }")),(0,r.kt)("td",{parentName:"tr",align:null},"A map of ",(0,r.kt)("a",{parentName:"td",href:"/docs/server/configuration"},"configuration values")," to pass to Pathling")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling.secretConfig")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"{ }")),(0,r.kt)("td",{parentName:"tr",align:null},"A map of secret configuration values to pass to Pathling, these values will be stored using ",(0,r.kt)("a",{parentName:"td",href:"https://kubernetes.io/docs/concepts/configuration/secret/"},"Kubernetes secrets"))))),(0,r.kt)("h2",{id:"example-configuration"},"Example configuration"),(0,r.kt)("p",null,"Here are a few examples of how to configure the Pathling Helm chart for\ndifferent deployment scenarios."),(0,r.kt)("h3",{id:"single-node"},"Single node"),(0,r.kt)("p",null,"This configuration is suitable for a single node deployment of Pathling. In this\nscenario, all processing is performed on a single pod."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'pathling:\n    image: aehrc/pathling:7\n    resources:\n        requests:\n            cpu: 2\n            memory: 4G\n        limits:\n            memory: 4G\n        maxHeapSize: 3g\n    volumes:\n        -   name: warehouse\n            hostPath:\n                path: /home/user/data/pathling\n    volumeMounts:\n        -   name: warehouse\n            mountPath: /usr/share/warehouse\n            readOnly: false\n    config:\n        pathling.implementationDescription: My Pathling Server\n        pathling.terminology.cache.maxEntries: 500000\n        pathling.terminology.cache.overrideExpiry: "2592000"\n        pathling.encoding.openTypes: string,code,decimal,Coding,Address\n        logging.level.au.csiro.pathling: debug\n')),(0,r.kt)("h3",{id:"cluster"},"Cluster"),(0,r.kt)("p",null,"This configuration is suitable for a cluster deployment of Pathling, using the\n",(0,r.kt)("a",{parentName:"p",href:"https://spark.apache.org/docs/latest/running-on-kubernetes.html"},"Spark Kubernetes cluster manager"),".\nIn this scenario, the driver pod hosts an API but processing is performed on\nexecutor pods, which are spawned by the driver pod through calls to the\nKubernetes API."),(0,r.kt)("p",null,"This configuration is suitable for the processing of larger datasets, or\nscenarios where it may be desirable to run a small driver pod and spawn executor\npods on demand (at the cost of some latency)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'pathling:\n    image: aehrc/pathling:7\n    resources:\n        requests:\n            cpu: 1\n            memory: 2G\n        limits:\n            memory: 2G\n        maxHeapSize: 1500m\n    volumes:\n        -   name: warehouse\n            hostPath:\n                path: /home/user/data/pathling\n    volumeMounts:\n        -   name: warehouse\n            mountPath: /usr/share/warehouse\n            readOnly: false\n    serviceAccount: spark-service-account\n    config:\n        pathling.implementationDescription: My Pathling Server\n        pathling.terminology.cache.maxEntries: 500000\n        pathling.terminology.cache.overrideExpiry: "2592000"\n        pathling.encoding.openTypes: string,code,decimal,Coding,Address\n        logging.level.au.csiro.pathling: debug\n        spark.master: k8s://https://kubernetes.default.svc\n        spark.kubernetes.namespace: pathling\n        spark.kubernetes.executor.container.image: aehrc/pathling:7\n        spark.kubernetes.executor.volumes.hostPath.warehouse.options.path: /home/user/data/pathling\n        spark.kubernetes.executor.volumes.hostPath.warehouse.mount.path: /usr/share/warehouse\n        spark.kubernetes.executor.volumes.hostPath.warehouse.mount.readOnly: false\n        spark.executor.instances: 3\n        spark.executor.memory: 3G\n        spark.kubernetes.executor.request.cores: 2\n        spark.kubernetes.executor.limit.cores: 2\n        spark.kubernetes.executor.request.memory: 4G\n        spark.kubernetes.executor.limit.memory: 4G\n')))}m.isMDXComponent=!0}}]);