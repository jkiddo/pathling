"use strict";(self.webpackChunkpathling_site=self.webpackChunkpathling_site||[]).push([[652],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},h="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),h=p(n),u=r,m=h["".concat(s,".").concat(u)]||h[u]||d[u]||i;return n?a.createElement(m,o(o({ref:t},c),{},{components:n})):a.createElement(m,o({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[h]="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},5121:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const i={sidebar_position:6,description:"Pathling can perform the role of a resource server within the OpenID Connect framework."},o="Authorization",l={unversionedId:"server/authorization",id:"server/authorization",title:"Authorization",description:"Pathling can perform the role of a resource server within the OpenID Connect framework.",source:"@site/docs/server/authorization.md",sourceDirName:"server",slug:"/server/authorization",permalink:"/docs/server/authorization",draft:!1,editUrl:"https://github.com/aehrc/pathling/tree/main/site/docs/server/authorization.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6,description:"Pathling can perform the role of a resource server within the OpenID Connect framework."},sidebar:"server",previous:{title:"Configuration",permalink:"/docs/server/configuration"},next:{title:"Async",permalink:"/docs/server/async"}},s={},p=[{value:"Authorities",id:"authorities",level:2},{value:"GA4GH passports",id:"ga4gh-passports",level:2}],c={toc:p},h="wrapper";function d(e){let{components:t,...i}=e;return(0,r.kt)(h,(0,a.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"authorization"},"Authorization"),(0,r.kt)("p",null,"Pathling can perform the role of a resource server within the\n",(0,r.kt)("a",{parentName:"p",href:"https://openid.net/connect/"},"OpenID Connect framework"),"."),(0,r.kt)("p",null,"When authorization is enabled through configuration, Pathling will refuse any\nrequests which are not accompanied by a valid\n",(0,r.kt)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc6750"},"bearer token"),". The following requirements\nmust be met:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Token is a ",(0,r.kt)("a",{parentName:"li",href:"https://tools.ietf.org/html/rfc7519"},"JSON Web Token")),(0,r.kt)("li",{parentName:"ul"},"Token contains an\n",(0,r.kt)("a",{parentName:"li",href:"https://tools.ietf.org/html/rfc7519#section-4.1.3"},"audience claim")," that\nmatches the configured value"),(0,r.kt)("li",{parentName:"ul"},"Token contains\nan ",(0,r.kt)("a",{parentName:"li",href:"https://tools.ietf.org/html/rfc7519#section-4.1.1"},"issuer claim"),"\nthat matches the configured value"),(0,r.kt)("li",{parentName:"ul"},"Issuer provides\nan ",(0,r.kt)("a",{parentName:"li",href:"https://openid.net/specs/openid-connect-discovery-1_0.html"},"OpenID Connect Discovery endpoint"),"\nthat provides information about how to validate the token, including a link to\na\n",(0,r.kt)("a",{parentName:"li",href:"https://tools.ietf.org/html/rfc7517"},"JSON Web Key Set")," containing the signing\nkey. This endpoint needs to be accessible to the Pathling server.")),(0,r.kt)("h2",{id:"authorities"},"Authorities"),(0,r.kt)("p",null,"Pathling supports a set of authorities that control access to resources and\noperations. Authorities must be provided within the ",(0,r.kt)("inlineCode",{parentName:"p"},"authorities")," claim within\nthe JWT bearer token provided with each request."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Authorities",src:n(2320).Z+"#light-mode-only",title:"Authorities",width:"914",height:"351"}),"\n",(0,r.kt)("img",{alt:"Authorities",src:n(3939).Z+"#dark-mode-only",title:"Authorities",width:"937",height:"351"})),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Authority"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling")),(0,r.kt)("td",{parentName:"tr",align:null},"Provides access to all operations and resources, implies all other authorities.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling:read")),(0,r.kt)("td",{parentName:"tr",align:null},"Provides read access to all resource types.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling:read:[resource type]")),(0,r.kt)("td",{parentName:"tr",align:null},"Provides read access to only a specified resource type.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling:write")),(0,r.kt)("td",{parentName:"tr",align:null},"Provides write access to all resource types.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling:write:[resource type]")),(0,r.kt)("td",{parentName:"tr",align:null},"Provides write access to only a specified resource type.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling:import")),(0,r.kt)("td",{parentName:"tr",align:null},"Provides access to the import operation.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling:aggregate")),(0,r.kt)("td",{parentName:"tr",align:null},"Provides access to the aggregate operation.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling:search")),(0,r.kt)("td",{parentName:"tr",align:null},"Provides access to the search operation.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling:extract")),(0,r.kt)("td",{parentName:"tr",align:null},"Provides access to the extract operation.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling:update")),(0,r.kt)("td",{parentName:"tr",align:null},"Provides access to the update operation.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"pathling:batch")),(0,r.kt)("td",{parentName:"tr",align:null},"Provides access to the batch operation.")))),(0,r.kt)("p",null,"In order to enable access to an operation, an operation authority (e.g.\n",(0,r.kt)("inlineCode",{parentName:"p"},"pathling:search"),") must be provided along with a ",(0,r.kt)("inlineCode",{parentName:"p"},"read")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"write")," authority\n(e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"pathling:read:Patient"),")."),(0,r.kt)("p",null,"Where expressions within a request reference multiple different resource types\n(e.g. through resource references), authority for read access to all those\nresources must be present within the token."),(0,r.kt)("p",null,"The import and batch operations require ",(0,r.kt)("inlineCode",{parentName:"p"},"write")," authority for all resource types\nthat are referenced within the request."),(0,r.kt)("h2",{id:"ga4gh-passports"},"GA4GH passports"),(0,r.kt)("p",null,"Pathling supports an opt-in implementation of\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ga4gh-duri/ga4gh-duri.github.io/blob/master/researcher_ids/ga4gh_passport_v1.md"},"GA4GH Passport v1"),",\nwhich is a way of encoding permission to access patient data within the access\ntoken presented to the server."),(0,r.kt)("p",null,"You can enable GA4GH passport authentication by enabling the ",(0,r.kt)("inlineCode",{parentName:"p"},"ga4gh")," Spring\nprofile when running Pathling. Note that this profile is not enabled by default,\nand is not enabled within the pre-built Docker image."),(0,r.kt)("p",null,"The Pathling implementation supports a visa type of ",(0,r.kt)("inlineCode",{parentName:"p"},"ControlledAccessGrants"),",\nwith a value that is interpreted as a dataset ID."),(0,r.kt)("p",null,"The issuer and the dataset ID are used to construct a URL of the form\n",(0,r.kt)("inlineCode",{parentName:"p"},"[issuer]/api/manifest/[dataset ID]"),", which is used to retrieve a manifest\ndocument. The manifest contains additional information on how to enforce\npermissions for the visa."),(0,r.kt)("p",null,"The manifest document is expected to take the following form:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "patientIds": [\n    "patient-1",\n    "patient-2",\n    ...\n  ]\n}\n')),(0,r.kt)("p",null,"The patient IDs are combined with the\n",(0,r.kt)("inlineCode",{parentName:"p"},"pathling.auth.ga4ghPassports.patientIdSystem")," configuration parameter to create\nFHIR identifiers that Pathling can match against resources in the database."),(0,r.kt)("p",null,"When running with GA4GH passports enabled, all queries will be scoped to return\nonly records that relate to white-listed patients, according to the joining\nlogic defined within\nthe ",(0,r.kt)("a",{parentName:"p",href:"https://hl7.org/fhir/R4/compartmentdefinition-patient.html"},"FHIR Patient compartment"),"."),(0,r.kt)("p",null,"The presence of a ",(0,r.kt)("inlineCode",{parentName:"p"},"ControlledAccessGrants")," visa implies the following\nauthorities within Pathling: ",(0,r.kt)("inlineCode",{parentName:"p"},"pathling:aggregate"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"pathling:search"),",\n",(0,r.kt)("inlineCode",{parentName:"p"},"pathling:extract")," (plus read access to all resources within the Patient\ncompartment)."))}d.isMDXComponent=!0},3939:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/authorities-dark-c923573b0e997753385d61128b0bb85c.svg"},2320:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/authorities-497dd9f3ccbd3a56ab8569df1e1250c9.svg"}}]);